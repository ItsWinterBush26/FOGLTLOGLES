name: Update Submodules

on:
	schedule:
		# Runs every Monday at 00:00 UTC
		- cron: "0 0 * * 1"
	workflow_dispatch:

permissions:
  contents: write
  pull-requests: write

jobs:
	update:
		runs-on: ubuntu-latest
		steps:
			- name: Checkout repository
				uses: actions/checkout@v4
				with:
					fetch-depth: 1
					submodules: true

			- name: Git config
				run: |
					git config --global user.name 'github-actions[bot]'
					git config --global user.email 'github-actions[bot]@users.noreply.github.com'

			- name: Update submodules
				run: |
					git submodule update --init --remote --recursive --depth=1

			- name: Create Pull Request
				uses: peter-evans/create-pull-request@v6
				with:
					commit-message: 'chore: update submodules'
					title: 'chore: update submodules'
					body: |
						Automated submodule updates:
						- deps/shaderc
						- deps/spirv-cross
						- deps/xxHash
						
						This PR was created automatically by GitHub Actions.
					branch: update-submodules
					delete-branch: true
					labels: |
						automated pr
						dependencies